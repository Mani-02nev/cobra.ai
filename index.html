<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="description" content="CobrΔ AI - Intelligent Assistant">
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CobrΔ AI - Google Workspace</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js"></script>
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <script src="https://accounts.google.com/gsi/client" async defer></script>

    <style>
        /* --- THEME SYSTEM --- */
        :root {
            --bg-primary: #020617;
            --bg-secondary: #0f172a;
            --bg-tertiary: #1e293b;
            --bg-glass: rgba(2, 6, 23, 0.85);
            --bg-input: #0f172a;
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --text-tertiary: #64748b;
            --border-primary: #1e293b;
            --border-secondary: #334155;
            --accent: #10b981;
            --accent-hover: #059669;
            --accent-subtle: rgba(16, 185, 129, 0.15);
            --text-inverse: #ffffff;
            --danger-hover: rgba(239, 68, 68, 0.15);
            --danger-text: #ef4444;
        }

        html.light-theme {
            --bg-primary: #ffffff;
            --bg-secondary: #f1f5f9;
            --bg-tertiary: #e2e8f0;
            --bg-glass: rgba(255, 255, 255, 0.9);
            --bg-input: #ffffff;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-tertiary: #94a3b8;
            --border-primary: #e2e8f0;
            --border-secondary: #cbd5e1;
            --accent: #059669;
            --accent-hover: #047857;
            --accent-subtle: rgba(5, 150, 105, 0.1);
            --text-inverse: #ffffff;
            --danger-hover: rgba(220, 38, 38, 0.1);
            --danger-text: #dc2626;
        }

        /* --- BASE STYLES --- */
        html,
        body {
            height: 100%;
            overflow: hidden;
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: background-color 0.3s, color 0.3s;
        }

        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-secondary);
            border-radius: 3px;
        }

        /* --- COMPONENTS --- */
        .sidebar {
            background-color: var(--bg-glass);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border-right: 1px solid var(--border-primary);
            transition: all 0.3s ease;
            position: fixed;
            top: 0;
            left: 0;
            height: 100%;
            z-index: 40;
            width: 18rem;
        }

        @media (min-width: 768px) {
            .sidebar {
                position: relative;
                width: 5rem;
            }
        }

        .sidebar.sidebar-expanded {
            width: 18rem;
        }

        .sidebar-closed {
            transform: translateX(-100%);
        }

        @media (min-width: 768px) {
            .sidebar-closed {
                transform: translateX(0);
            }
        }

        .nav-btn {
            color: var(--text-secondary);
            transition: all 0.2s ease;
            border: 1px solid transparent;
        }

        .nav-btn:hover {
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
            border-color: var(--border-primary);
        }

        .nav-btn.active {
            background: linear-gradient(135deg, var(--accent), var(--accent-hover));
            color: var(--text-inverse);
            font-weight: 600;
            box-shadow: 0 4px 12px var(--accent-subtle);
            border-color: transparent;
        }

        @media (min-width: 768px) {

            .sidebar:not(.sidebar-expanded) .nav-text,
            .sidebar:not(.sidebar-expanded) .chat-list-title,
            .sidebar:not(.sidebar-expanded) .sidebar-collapsible {
                display: none;
            }

            .sidebar:not(.sidebar-expanded) .nav-btn {
                justify-content: center;
            }

            .sidebar:not(.sidebar-expanded) .nav-icon {
                margin-right: 0;
            }
        }

        .chat-input {
            background-color: var(--bg-input);
            border: 1px solid var(--border-primary);
            transition: all 0.2s ease;
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .chat-input:focus-within {
            border-color: var(--accent);
            box-shadow: 0 0 0 2px var(--accent-subtle);
        }

        /* --- MARKDOWN --- */
        .markdown-content pre {
            background-color: var(--bg-secondary);
            border-radius: 0 0 0.5rem 0.5rem;
            margin-top: 0 !important;
            padding: 1rem;
            border: 1px solid var(--border-primary);
            border-top: none;
        }

        .markdown-content .code-header {
            background-color: var(--bg-tertiary);
            color: var(--text-secondary);
            border: 1px solid var(--border-primary);
            border-bottom: 1px solid var(--border-primary);
            border-radius: 0.5rem 0.5rem 0 0;
        }

        .markdown-content code:not(pre code) {
            background-color: var(--bg-tertiary);
            color: var(--accent);
            padding: 0.2em 0.4em;
            border-radius: 4px;
            font-size: 85%;
            border: 1px solid var(--border-secondary);
        }

        .markdown-content blockquote {
            border-left: 4px solid var(--accent);
            background-color: var(--bg-secondary);
            padding: 0.5rem 1rem;
            color: var(--text-secondary);
        }

        .markdown-content a {
            color: var(--accent);
            text-decoration: none;
            border-bottom: 1px solid var(--accent);
        }

        /* --- UI ELEMENTS --- */
        .user-message-bubble {
            background: linear-gradient(135deg, var(--accent), var(--accent-hover));
            border: 1px solid var(--accent);
            padding: 0.75rem 1rem;
            border-radius: 1rem 1rem 0 1rem;
            max-width: 90%;
            color: var(--text-inverse);
            box-shadow: 0 4px 12px var(--accent-subtle);
        }

        .message-appear {
            animation: fade-in 0.3s ease-out;
        }

        @keyframes fade-in {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .text-gradient-suit {
            background: linear-gradient(to right, var(--accent), #34d399);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Loading */
        .dot-flashing {
            position: relative;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: var(--text-secondary);
            animation: dot-flashing 1s infinite linear alternate;
            animation-delay: .5s;
            margin-left: 4px;
        }

        .dot-flashing::before,
        .dot-flashing::after {
            content: '';
            display: inline-block;
            position: absolute;
            top: 0;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: var(--text-secondary);
        }

        .dot-flashing::before {
            left: -15px;
            animation-delay: 0s;
        }

        .dot-flashing::after {
            left: 15px;
            animation-delay: 1s;
        }

        @keyframes dot-flashing {
            0% {
                background-color: var(--text-secondary);
            }

            50%,
            100% {
                background-color: rgba(139, 148, 158, 0.3);
            }
        }

        /* Splash & Auth */
        #splash-screen {
            position: fixed;
            inset: 0;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--bg-primary);
            transition: opacity 0.5s ease-out;
        }

        #splash-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 44px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-tertiary);
            border: 1px solid var(--border-secondary);
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 2px;
            bottom: 2px;
            background-color: var(--text-secondary);
            transition: .4s;
            border-radius: 50%;
        }

        input:checked+.slider {
            background-color: var(--accent);
        }

        input:checked+.slider:before {
            transform: translateX(20px);
            background-color: #fff;
        }

        .mode-toggle-btn {
            display: flex;
            align-items: center;
            padding: 6px 12px;
            border-radius: 9999px;
            font-size: 12px;
            font-weight: 500;
            color: var(--text-secondary);
            background-color: transparent;
            border: 1px solid var(--border-primary);
            cursor: pointer;
        }

        .mode-toggle-btn.active {
            color: var(--text-inverse);
            background-color: var(--accent);
            border-color: var(--accent);
        }
    </style>
</head>

<body class="w-full h-full overflow-hidden flex">

    <div id="auth-screen"
        class="fixed inset-0 z-[100] flex items-center justify-center bg-[var(--bg-primary)] transition-opacity duration-500">
        <div
            class="relative w-full max-w-sm p-8 m-4 overflow-hidden rounded-2xl bg-[var(--bg-glass)] backdrop-blur-xl border border-[var(--border-primary)] shadow-2xl">
            <div
                class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-[var(--accent)] to-transparent">
            </div>

            <div class="text-center mb-8">
                <h1 class="text-4xl font-extrabold text-gradient-suit mb-2">CobrΔ</h1>
                <p class="text-[var(--text-secondary)] text-sm">Protected Workspace.</p>
                <p id="auth-instruction" class="text-xs text-[var(--text-tertiary)] mt-1">Please sign in with Google.
                </p>
            </div>

            <div class="flex justify-center w-full min-h-[50px]">
                <div id="g_id_onload" data-callback="handleCredentialResponse" data-auto_prompt="false"
                    data-theme="filled_black">
                </div>
                <div class="g_id_signin" data-type="standard" data-size="large" data-theme="outline"
                    data-text="sign_in_with" data-shape="rectangular" data-logo_alignment="left">
                </div>
            </div>

            <p id="config-error" class="text-xs text-[var(--danger-text)] text-center mt-4 hidden">
                Configuration Missing! Open code and set CLIENT_ID.
            </p>
        </div>
    </div>

    <input type="file" id="imageUploadInput" accept="image/*" class="hidden">
    <input type="file" id="fileUploadInput" accept=".txt,.js,.py,.html,.css,.md,.json" class="hidden">

    <div id="splash-screen" class="hidden">
        <h2 class="text-6xl font-extrabold text-gradient-suit">CobrΔ</h2>
    </div>

    <aside id="sidebar"
        class="sidebar sidebar-closed w-72 md:w-20 flex-shrink-0 flex flex-col transition-all duration-300 ease-in-out overflow-hidden">
        <div class="p-2 flex-shrink-0 hidden md:flex md:justify-center">
            <button id="desktop-sidebar-toggle" class="nav-btn p-3 rounded-lg"><svg class="w-5 h-5" fill="none"
                    viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
                </svg></button>
        </div>
        <div class="p-2 space-y-2 border-y border-[var(--border-primary)] flex-shrink-0">
            <button id="newChatBtn" class="nav-btn w-full text-left relative flex items-center p-3 rounded-lg">
                <svg class="w-5 h-5 flex-shrink-0 nav-icon mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                    stroke-width="2">
                    <path d="M12 4v16m8-8H4" />
                </svg>
                <span class="nav-text whitespace-nowrap font-bold">New Chat</span>
            </button>
        </div>
        <div class="p-2 sidebar-collapsible flex-shrink-0">
            <div class="flex items-center justify-between px-2 mb-1">
                <h3 class="text-xs font-semibold text-[var(--text-tertiary)] uppercase tracking-wider">Projects</h3>
                <button id="addProjectBtn" class="text-[var(--accent)] hover:text-[var(--accent-hover)]"><svg
                        class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path d="M12 4v16m8-8H4" />
                    </svg></button>
            </div>
            <div id="projectsListContainer" class="space-y-1 overflow-y-auto max-h-32"></div>
        </div>
        <div class="flex-1 p-2 space-y-1 overflow-y-auto">
            <h3
                class="px-4 py-2 text-xs font-semibold text-[var(--text-tertiary)] uppercase tracking-wider chat-list-title sidebar-collapsible">
                Recent</h3>
            <div id="chatListContainer"></div>
        </div>
        <div class="p-2 border-t border-[var(--border-primary)] text-xs text-[var(--text-secondary)] flex-shrink-0">
            <button id="settingsBtn" class="nav-btn w-full text-left relative flex items-center p-3 rounded-lg">
                <svg class="w-5 h-5 flex-shrink-0 nav-icon mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                    stroke-width="2">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path
                        d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                    </path>
                </svg>
                <span class="nav-text whitespace-nowrap">Settings</span>
            </button>
        </div>
    </aside>

    <div class="flex-1 flex flex-col h-full bg-[var(--bg-primary)] min-w-0">
        <header
            class="flex items-center justify-between p-2 bg-[var(--bg-glass)] backdrop-blur-md border-b border-[var(--border-primary)] flex-shrink-0 sticky top-0 z-20">
            <button id="menu-toggle"
                class="md:hidden text-[var(--text-secondary)] p-2 rounded-lg hover:bg-[var(--bg-tertiary)] transition-colors"><svg
                    class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7">
                    </path>
                </svg></button>
            <div class="flex-1"></div>
            <div class="flex items-center p-3 h-16 flex-shrink-0">
                <span class="text-xl font-bold mr-2 whitespace-nowrap hidden md:inline text-gradient-suit">CobrΔ</span>
                <div
                    class="w-9 h-9 rounded-full flex-shrink-0 flex items-center justify-center bg-gradient-to-br from-emerald-500 to-emerald-700 shadow-lg shadow-emerald-900/50">
                    <svg class="w-5 h-5 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M20 9V7a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v2" />
                        <path d="M12 11v10" />
                        <path d="M4.1 11H20" />
                        <path d="M17.8 11.1 15 15" />
                        <path d="M6.2 11.1 9 15" />
                        <path d="m13 20 4-4" />
                        <path d="m7 20-4-4" />
                    </svg>
                </div>
            </div>
            <button id="export-chat-btn"
                class="text-[var(--text-secondary)] p-2 rounded-lg hover:bg-[var(--bg-tertiary)] transition-colors"><svg
                    class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7 10 12 15 17 10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                </svg></button>
        </header>

        <main class="flex-1 flex flex-col overflow-hidden">
            <div id="chatContainer" class="flex-1 overflow-y-auto p-4 md:p-6 space-y-8">
                <div id="emptyChatPlaceholder"
                    class="flex flex-col items-center justify-center h-full text-[var(--text-secondary)]">
                    <h2 class="text-6xl font-extrabold mb-4 text-gradient-suit">CobrΔ</h2>
                    <p class="mt-2 text-center text-sm tracking-wide">Efficiency. Precision. Intelligence.</p>
                </div>
            </div>
            <div class="p-4 chat-input-wrapper flex-shrink-0 bg-[var(--bg-primary)]">
                <div class="max-w-3xl mx-auto">
                    <div class="flex flex-wrap items-center justify-start gap-2 px-3 mb-2">
                        <button id="mode-toggle-none" class="mode-toggle-btn active" title="Standard"><svg
                                class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="1.1"></circle>
                                <path
                                    d="M12 2a10 10 0 0 1 10 10 10 10 0 0 1-10 10 10 10 0 0 1-10-10 10 10 0 0 1 10-10z">
                                </path>
                            </svg><span class="ml-1.5">Standard</span></button>
                        <button id="mode-toggle-web" class="mode-toggle-btn" title="Factual"><svg class="w-4 h-4"
                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="2" y1="12" x2="22" y2="12"></line>
                                <path
                                    d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z">
                                </path>
                            </svg><span class="ml-1.5">Factual</span></button>
                        <button id="mode-toggle-creative" class="mode-toggle-btn" title="Creative"><svg class="w-4 h-4"
                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 3L9.5 8.5 4 10l5.5 5.5L8 21l4-3 4 3-1.5-5.5L20 10l-5.5-1.5z" />
                            </svg><span class="ml-1.5">Creative</span></button>
                        <div class="relative"><select id="persona-select" class="mode-toggle-btn appearance-none"
                                style="padding-right: 2rem;">
                                <option value="">Default Persona</option>
                                <option value="You are a master Python programmer.">Python Expert</option>
                                <option value="You are a creative writer.">Creative Writer</option>
                                <option value="You are a strict code reviewer.">Code Reviewer</option>
                            </select><svg
                                class="w-4 h-4 absolute right-2 top-1/2 -translate-y-1/2 text-[var(--text-secondary)] pointer-events-none"
                                xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                    clip-rule="evenodd" />
                            </svg></div>
                    </div>

                    <div id="attachment-preview"
                        class="hidden p-2 mb-2 border border-[var(--border-secondary)] rounded-lg relative bg-[var(--bg-input)]">
                        <button id="remove-attachment-btn"
                            class="absolute -top-2 -right-2 p-1 bg-[var(--bg-tertiary)] rounded-full text-[var(--text-primary)] hover:bg-[var(--danger-hover)] hover:text-[var(--danger-text)]"><svg
                                class="w-4 h-4" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                                    clip-rule="evenodd" />
                            </svg></button>
                        <div id="attachment-preview-content" class="flex items-center gap-2"></div>
                    </div>

                    <div class="flex items-end chat-input rounded-xl p-2">
                        <button id="attach-file-btn"
                            class="p-2 rounded-lg text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]"><svg
                                class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path
                                    d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48">
                                </path>
                            </svg></button>
                        <button id="upload-image-btn"
                            class="p-2 rounded-lg text-[var(--text-secondary)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-tertiary)]"><svg
                                class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                <polyline points="21 15 16 10 5 21"></polyline>
                            </svg></button>
                        <textarea id="userQuestion" rows="1" placeholder="Ask CobrΔ anything..."
                            class="flex-1 bg-transparent text-[var(--text-primary)] focus:outline-none resize-none px-2 max-h-48 self-center"></textarea>
                        <button id="askBtn"
                            class="bg-[var(--accent)] hover:bg-[var(--accent-hover)] text-white p-2 rounded-lg ml-2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed self-end"><svg
                                class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="22" y1="2" x2="11" y2="13"></line>
                                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                            </svg></button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div id="settings-modal-overlay" class="hidden fixed inset-0 bg-black bg-opacity-60 z-40"></div>
    <div id="settings-modal"
        class="hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-md z-50">
        <div
            class="m-4 bg-[var(--bg-glass)] backdrop-blur-xl border border-[var(--border-primary)] rounded-lg shadow-2xl text-[var(--text-primary)]">
            <div class="flex items-center justify-between p-4 border-b border-[var(--border-primary)]">
                <h2 class="text-lg font-semibold">Settings</h2><button id="close-settings-btn"
                    class="p-2 rounded-full hover:bg-[var(--bg-tertiary)]"><svg width="24" height="24"
                        viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg></button>
            </div>
            <div class="p-6 space-y-6">
                <div class="flex items-center justify-between"><label for="theme-toggle" class="font-medium">Light
                        Mode</label><label class="switch"><input type="checkbox" id="theme-toggle"><span
                            class="slider"></span></label></div>

                <button id="open-archives-btn"
                    class="w-full flex items-center justify-between p-3 rounded-lg border border-[var(--border-primary)] hover:bg-[var(--bg-tertiary)]">
                    <div class="flex items-center gap-3"><svg class="w-5 h-5 text-[var(--accent)]"
                            xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                            stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" />
                        </svg><span>Archived Chats</span></div>
                </button>

                <div class="border-t border-[var(--border-primary)] pt-4 mt-4">
                    <button id="logout-btn"
                        class="w-full flex items-center justify-center gap-2 p-2 mb-4 text-xs font-bold text-[var(--danger-text)] border border-[var(--danger-text)] rounded-lg hover:bg-[var(--danger-hover)] transition-colors">Sign
                        Out</button>
                    <div class="flex justify-between items-center">
                        <div>
                            <h3 class="font-semibold">CobrΔ AI</h3>
                            <p class="text-xs text-[var(--text-secondary)]">v2.5 Google</p>
                        </div>
                        <div class="text-right flex items-center gap-2">
                            <p id="user-display-name" class="text-xs font-mono text-[var(--accent)]">Unknown</p>
                            <img id="user-avatar"
                                class="w-8 h-8 rounded-full hidden border border-[var(--border-secondary)]" src=""
                                alt="User">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="archive-modal"
        class="hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-lg z-50">
        <div
            class="m-4 bg-[var(--bg-glass)] backdrop-blur-xl border border-[var(--border-primary)] rounded-lg shadow-2xl text-[var(--text-primary)] h-[80vh] flex flex-col">
            <div class="flex items-center justify-between p-4 border-b border-[var(--border-primary)]">
                <h2 class="text-lg font-semibold">Archived Chats</h2><button id="close-archive-btn"
                    class="p-2 rounded-full hover:bg-[var(--bg-tertiary)]"><svg width="24" height="24"
                        viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg></button>
            </div>
            <div id="archiveListContainer" class="flex-1 p-4 overflow-y-auto space-y-2"></div>
        </div>
    </div>
    <div id="project-modal"
        class="hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-sm z-50">
        <div
            class="m-4 bg-[var(--bg-glass)] backdrop-blur-xl border border-[var(--border-primary)] rounded-lg shadow-2xl text-[var(--text-primary)]">
            <div class="p-6">
                <h3 class="text-lg font-semibold mb-4">Create New Project</h3>
                <div class="space-y-4">
                    <div><label class="block text-xs font-medium text-[var(--text-secondary)] mb-1">Project
                            Name</label><input type="text" id="projectNameInput"
                            class="w-full p-2 rounded-lg bg-[var(--bg-input)] border border-[var(--border-primary)] focus:border-[var(--accent)] outline-none"
                            placeholder="My Awesome Project"></div>
                </div>
                <div class="flex justify-end gap-3 mt-6"><button id="cancel-project-btn"
                        class="nav-btn px-4 py-2 rounded-lg">Cancel</button><button id="save-project-btn"
                        class="bg-[var(--accent)] text-white px-4 py-2 rounded-lg hover:bg-[var(--accent-hover)]">Create</button>
                </div>
            </div>
        </div>
    </div>
    <div id="custom-modal-overlay" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50"></div>
    <div id="custom-modal"
        class="hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-sm z-50 message-appear">
        <div
            class="m-4 bg-[var(--bg-glass)] backdrop-blur-xl border border-[var(--border-primary)] rounded-lg shadow-2xl text-[var(--text-primary)]">
            <div class="p-6">
                <h3 id="custom-modal-title" class="text-lg font-semibold mb-2"></h3>
                <p id="custom-modal-message" class="text-sm text-[var(--text-secondary)] mb-6"></p>
                <div id="custom-modal-buttons" class="flex justify-end gap-3"><button id="custom-modal-btn-cancel"
                        class="nav-btn px-4 py-2 rounded-lg">Cancel</button><button id="custom-modal-btn-confirm"
                        class="bg-[var(--danger-text)] text-white px-4 py-2 rounded-lg hover:bg-opacity-80 transition-colors">Confirm</button>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { GoogleGenerativeAI } from "https://cdn.jsdelivr.net/npm/@google/generative-ai/+esm";

        // =========================================================
        //  ⚠️ CONFIGURATION - REQUIRED (EDIT THIS)
        // =========================================================

        const GEMINI_API_KEY = "AIzaSyCVvLGL8sWqk78uS3oa1u0wx2WcJUgZ1oA";

        // PASTE YOUR CLIENT ID HERE (From Google Cloud Console)
        // Example: "123456789-abcdefg.apps.googleusercontent.com"
        const GOOGLE_CLIENT_ID = "837555779713-i0ss5lf307gsnk3br5voj1tvf8es0r2o.apps.googleusercontent.com";

        // =========================================================

        let currentChatId = null;
        let currentProjectId = 'default';
        let currentChatMode = 'none';
        let genAI;
        let generativeModel;
        let attachedFileData = null;
        let confirmCallback = null;
        const markdownConverter = new showdown.Converter({ tables: true, strikethrough: true, simplifiedAutoLink: true });

        const dom = {
            authScreen: document.getElementById('auth-screen'),
            googleBtnContainer: document.getElementById('g_id_onload'),
            configError: document.getElementById('config-error'),
            userDisplayName: document.getElementById('user-display-name'),
            userAvatar: document.getElementById('user-avatar'),
            logoutBtn: document.getElementById('logout-btn'),
            splashScreen: document.getElementById('splash-screen'),
            askBtn: document.getElementById("askBtn"),
            userQuestion: document.getElementById("userQuestion"),
            chatContainer: document.getElementById("chatContainer"),
            emptyChatPlaceholder: document.getElementById('emptyChatPlaceholder'),
            newChatBtn: document.getElementById('newChatBtn'),
            sidebar: document.getElementById('sidebar'),
            menuToggle: document.getElementById('menu-toggle'),
            desktopSidebarToggle: document.getElementById('desktop-sidebar-toggle'),
            chatListContainer: document.getElementById('chatListContainer'),
            settingsBtn: document.getElementById('settingsBtn'),
            settingsModal: document.getElementById('settings-modal'),
            settingsModalOverlay: document.getElementById('settings-modal-overlay'),
            closeSettingsBtn: document.getElementById('close-settings-btn'),
            themeToggle: document.getElementById('theme-toggle'),
            htmlEl: document.documentElement,
            modeToggleNone: document.getElementById('mode-toggle-none'),
            modeToggleWeb: document.getElementById('mode-toggle-web'),
            modeToggleCreative: document.getElementById('mode-toggle-creative'),
            imageUploadInput: document.getElementById('imageUploadInput'),
            fileUploadInput: document.getElementById('fileUploadInput'),
            attachFileBtn: document.getElementById('attach-file-btn'),
            uploadImageBtn: document.getElementById('upload-image-btn'),
            attachmentPreview: document.getElementById('attachment-preview'),
            attachmentPreviewContent: document.getElementById('attachment-preview-content'),
            removeAttachmentBtn: document.getElementById('remove-attachment-btn'),
            projectsListContainer: document.getElementById('projectsListContainer'),
            addProjectBtn: document.getElementById('addProjectBtn'),
            projectModal: document.getElementById('project-modal'),
            projectNameInput: document.getElementById('projectNameInput'),
            saveProjectBtn: document.getElementById('save-project-btn'),
            cancelProjectBtn: document.getElementById('cancel-project-btn'),
            openArchivesBtn: document.getElementById('open-archives-btn'),
            archiveModal: document.getElementById('archive-modal'),
            closeArchiveBtn: document.getElementById('close-archive-btn'),
            archiveListContainer: document.getElementById('archiveListContainer'),
            customModal: document.getElementById('custom-modal'),
            customModalOverlay: document.getElementById('custom-modal-overlay'),
            customModalTitle: document.getElementById('custom-modal-title'),
            customModalMessage: document.getElementById('custom-modal-message'),
            customModalBtnConfirm: document.getElementById('custom-modal-btn-confirm'),
            customModalBtnCancel: document.getElementById('custom-modal-btn-cancel')
        };

        // --- AUTH LOGIC (Google) ---

        window.handleCredentialResponse = function (response) {
            const responsePayload = decodeJwtResponse(response.credential);
            localStorage.setItem('cobra_google_token', response.credential);
            localStorage.setItem('cobra_user_name', responsePayload.name);
            localStorage.setItem('cobra_user_pic', responsePayload.picture);
            completeLogin(responsePayload.name, responsePayload.picture);
        }

        function decodeJwtResponse(token) {
            var base64Url = token.split('.')[1];
            var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            var jsonPayload = decodeURIComponent(window.atob(base64).split('').map(function (c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));
            return JSON.parse(jsonPayload);
        }

        function checkAuth() {
            // Config Check
            if (!GOOGLE_CLIENT_ID || GOOGLE_CLIENT_ID.includes("PASTE")) {
                dom.configError.classList.remove('hidden');
                if (dom.googleBtnContainer) dom.googleBtnContainer.style.display = 'none';
                return;
            } else {
                if (dom.googleBtnContainer) dom.googleBtnContainer.setAttribute('data-client_id', GOOGLE_CLIENT_ID);
            }

            const token = localStorage.getItem('cobra_google_token');
            const name = localStorage.getItem('cobra_user_name');
            const pic = localStorage.getItem('cobra_user_pic');

            if (token && name) {
                completeLogin(name, pic);
            } else {
                dom.authScreen.classList.remove('hidden');
                dom.splashScreen.classList.add('hidden');
            }
        }

        function completeLogin(name, pic) {
            dom.authScreen.classList.add('hidden');
            dom.splashScreen.classList.remove('hidden');

            dom.userDisplayName.textContent = name;
            if (pic) {
                dom.userAvatar.src = pic;
                dom.userAvatar.classList.remove('hidden');
            }

            initializeAI();
        }

        function handleLogout() {
            localStorage.removeItem('cobra_google_token');
            localStorage.removeItem('cobra_user_name');
            localStorage.removeItem('cobra_user_pic');
            if (typeof google !== 'undefined') google.accounts.id.disableAutoSelect();
            window.location.reload();
        }

        dom.logoutBtn.addEventListener('click', handleLogout);

        // --- CORE UI LOGIC ---

        function initializeAI() {
            try {
                if (!GEMINI_API_KEY || GEMINI_API_KEY.includes("PASTE")) {
                    alert("Gemini API Key missing. Please edit the code.");
                    return;
                }
                genAI = new GoogleGenerativeAI(GEMINI_API_KEY);
                const savedTheme = localStorage.getItem('cobra-theme-v1') || 'dark';
                applyTheme(savedTheme);
                dom.themeToggle.checked = (savedTheme === 'light');
                renderProjects();
                renderChatList();
                autoResizeTextarea();

                setTimeout(() => { dom.splashScreen.classList.add('hidden'); }, 1500);
            } catch (e) { console.error(e); }
        }

        // Listeners
        dom.askBtn.addEventListener("click", handleAsk);
        dom.userQuestion.addEventListener("keydown", e => { if (e.key === "Enter" && !e.shiftKey) { e.preventDefault(); handleAsk(); } });
        dom.userQuestion.addEventListener('input', autoResizeTextarea);
        dom.newChatBtn.addEventListener('click', () => startNewChat(true));

        // Sidebar
        dom.menuToggle.addEventListener('click', () => dom.sidebar.classList.toggle('sidebar-closed'));
        dom.desktopSidebarToggle.addEventListener('click', () => dom.sidebar.classList.toggle('sidebar-expanded'));

        // Modals
        const toggleModal = (modal, overlay, show) => { if (show) { modal.classList.remove('hidden'); overlay.classList.remove('hidden'); } else { modal.classList.add('hidden'); overlay.classList.add('hidden'); } };
        dom.settingsBtn.addEventListener('click', () => toggleModal(dom.settingsModal, dom.settingsModalOverlay, true));
        dom.closeSettingsBtn.addEventListener('click', () => toggleModal(dom.settingsModal, dom.settingsModalOverlay, false));
        dom.settingsModalOverlay.addEventListener('click', () => toggleModal(dom.settingsModal, dom.settingsModalOverlay, false));
        dom.openArchivesBtn.addEventListener('click', () => { toggleModal(dom.settingsModal, dom.settingsModalOverlay, false); openArchiveModal(); });
        dom.closeArchiveBtn.addEventListener('click', () => toggleModal(dom.archiveModal, dom.settingsModalOverlay, false));

        // Projects
        dom.addProjectBtn.addEventListener('click', () => toggleModal(dom.projectModal, dom.settingsModalOverlay, true));
        dom.cancelProjectBtn.addEventListener('click', () => toggleModal(dom.projectModal, dom.settingsModalOverlay, false));
        dom.saveProjectBtn.addEventListener('click', saveNewProject);

        // Files
        dom.uploadImageBtn.addEventListener('click', () => dom.imageUploadInput.click());
        dom.attachFileBtn.addEventListener('click', () => dom.fileUploadInput.click());
        dom.imageUploadInput.addEventListener('change', handleFileSelect);
        dom.fileUploadInput.addEventListener('change', handleFileSelect);
        dom.removeAttachmentBtn.addEventListener('click', removeAttachment);

        // Theme & Mode
        dom.themeToggle.addEventListener('change', () => { const t = dom.themeToggle.checked ? 'light' : 'dark'; localStorage.setItem('cobra-theme-v1', t); applyTheme(t); });
        function applyTheme(t) { t === 'light' ? dom.htmlEl.classList.add('light-theme') : dom.htmlEl.classList.remove('light-theme'); }

        dom.modeToggleNone.addEventListener('click', () => setChatMode('none'));
        dom.modeToggleWeb.addEventListener('click', () => setChatMode('web'));
        dom.modeToggleCreative.addEventListener('click', () => setChatMode('creative'));
        function setChatMode(mode) { currentChatMode = mode; dom.modeToggleNone.classList.remove('active'); dom.modeToggleWeb.classList.remove('active'); dom.modeToggleCreative.classList.remove('active'); if (mode === 'web') dom.modeToggleWeb.classList.add('active'); else if (mode === 'creative') dom.modeToggleCreative.classList.add('active'); else dom.modeToggleNone.classList.add('active'); }

        // --- CHAT LOGIC ---
        const CHAT_STORAGE_KEY = 'cobra-chats-v1';
        const PROJECT_STORAGE_KEY = 'cobra-projects-v1';

        function getAllChats() { return JSON.parse(localStorage.getItem(CHAT_STORAGE_KEY) || '{}'); }
        function loadChatHistory(id) { return (id === 'temp' || !id) ? [] : (getAllChats()[id]?.history || []); }
        function saveChatHistory(id, hist) { if (id === 'temp') return; const c = getAllChats(); if (c[id]) { c[id].history = hist; localStorage.setItem(CHAT_STORAGE_KEY, JSON.stringify(c)); } }

        async function handleAsk() {
            const q = dom.userQuestion.value.trim();
            if (!q && !attachedFileData) return;

            if (!currentChatId) { currentChatId = crypto.randomUUID(); saveChatTitle(currentChatId, q.substring(0, 40) || 'New Chat'); renderChatList(); }

            let hist = loadChatHistory(currentChatId);
            const userMsg = { role: "user", parts: [] };
            if (q) userMsg.parts.push({ text: q });
            if (attachedFileData) userMsg.parts.push({ inlineData: { mimeType: attachedFileData.mimeType, data: attachedFileData.data.split(",")[1] } });

            appendMessage({ text: q, sender: 'user', attachment: attachedFileData });
            hist.push(userMsg);
            removeAttachment(); dom.userQuestion.value = ''; autoResizeTextarea(); showTypingIndicator();

            try {
                const persona = document.getElementById('persona-select').value;
                const temp = currentChatMode === 'creative' ? 1.0 : (currentChatMode === 'web' ? 0.3 : 0.8);
                generativeModel = genAI.getGenerativeModel({ model: "gemini-2.0-flash", generationConfig: { temperature: temp }, systemInstruction: persona || undefined });

                const chat = generativeModel.startChat({ history: hist.slice(0, -1) }); // Send previous history
                const result = await chat.sendMessageStream(userMsg.parts);

                removeTypingIndicator();
                const botCont = appendMessage({ text: '', sender: 'bot' });
                let fullText = "";

                for await (const chunk of result.stream) {
                    fullText += chunk.text();
                    botCont.innerHTML = markdownConverter.makeHtml(fullText);
                    dom.chatContainer.scrollTop = dom.chatContainer.scrollHeight;
                }
                processCodeBlocks(botCont);
                hist.push({ role: "model", parts: [{ text: fullText }] });
                saveChatHistory(currentChatId, hist);
            } catch (e) {
                removeTypingIndicator();
                appendMessage({ text: "Error: " + e.message, sender: 'bot' });
            }
        }

        function appendMessage({ text, sender, attachment }) {
            dom.emptyChatPlaceholder.classList.add('hidden');
            const div = document.createElement('div'); div.classList.add('message-appear', 'mt-4');
            const botIcon = `<div class="w-8 h-8 rounded-full bg-emerald-600 flex items-center justify-center flex-shrink-0 text-white text-xs">AI</div>`;

            let attachHtml = '';
            if (attachment) attachHtml = (attachment.mimeType.startsWith('image/')) ? `<img src="${attachment.data}" class="mt-2 w-32 rounded-lg">` : `<div class="mt-2 p-2 bg-[var(--bg-tertiary)] rounded text-xs">File: ${attachment.name}</div>`;

            if (sender === 'bot') {
                div.innerHTML = `<div class="flex gap-3 max-w-3xl mx-auto">${botIcon}<div class="flex-1 markdown-content"><div class="content-text">${text}</div></div></div>`;
            } else {
                div.innerHTML = `<div class="flex justify-end max-w-3xl mx-auto"><div class="user-message-bubble"><div class="content-text">${text}</div>${attachHtml}</div></div>`;
            }

            const content = div.querySelector('.content-text');
            if (sender === 'bot' && text) content.innerHTML = markdownConverter.makeHtml(text);

            dom.chatContainer.appendChild(div);
            dom.chatContainer.scrollTop = dom.chatContainer.scrollHeight;
            return content;
        }

        // --- UTILS ---
        function startNewChat(persist) { currentChatId = persist ? crypto.randomUUID() : 'temp'; dom.chatContainer.innerHTML = ''; dom.emptyChatPlaceholder.classList.remove('hidden'); }
        function saveChatTitle(id, title) { if (id === 'temp') return; const c = getAllChats(); if (!c[id]) c[id] = { history: [], createdAt: new Date().toISOString(), projectId: currentProjectId, archived: false }; c[id].title = title; localStorage.setItem(CHAT_STORAGE_KEY, JSON.stringify(c)); }
        function renderChatList() {
            const chats = getAllChats();
            const filtered = Object.entries(chats).filter(([_, c]) => !c.archived && (currentProjectId === 'default' || c.projectId === currentProjectId)).sort(([, a], [, b]) => new Date(b.createdAt) - new Date(a.createdAt));
            dom.chatListContainer.innerHTML = filtered.map(([id, c]) => `<div onclick="window.loadChat('${id}')" class="p-2 hover:bg-[var(--bg-tertiary)] rounded cursor-pointer truncate text-sm text-[var(--text-secondary)]">${c.title || 'Untitled'}</div>`).join('');
        }
        window.loadChat = (id) => { currentChatId = id; dom.chatContainer.innerHTML = ''; const h = loadChatHistory(id); if (h.length === 0) { dom.emptyChatPlaceholder.classList.remove('hidden'); } else { h.forEach(m => { const txt = m.parts[0].text; appendMessage({ text: txt, sender: m.role === 'user' ? 'user' : 'bot' }); }); } };

        function autoResizeTextarea() { dom.userQuestion.style.height = 'auto'; dom.userQuestion.style.height = dom.userQuestion.scrollHeight + 'px'; }
        function showTypingIndicator() { const d = document.createElement('div'); d.id = "typing"; d.innerHTML = '<div class="flex gap-3 max-w-3xl mx-auto mt-4"><div class="w-8 h-8 rounded-full bg-emerald-600"></div><div class="dot-flashing mt-3"></div></div>'; dom.chatContainer.appendChild(d); }
        function removeTypingIndicator() { document.getElementById('typing')?.remove(); }

        function handleFileSelect(e) { const f = e.target.files[0]; if (!f) return; const r = new FileReader(); r.onload = () => { attachedFileData = { mimeType: f.type, data: r.result, name: f.name }; dom.attachmentPreview.classList.remove('hidden'); dom.attachmentPreviewContent.textContent = f.name; }; r.readAsDataURL(f); }
        function removeAttachment() { attachedFileData = null; dom.attachmentPreview.classList.add('hidden'); }

        function processCodeBlocks(el) {
            el.querySelectorAll("pre").forEach(pre => {
                const code = pre.querySelector("code");
                if (code) {
                    const wrapper = document.createElement("div"); wrapper.className = "rounded-lg border border-[var(--border-primary)] overflow-hidden mt-2";
                    wrapper.innerHTML = `<div class="bg-[var(--bg-tertiary)] p-1 text-right"><button class="text-xs px-2 py-1 text-[var(--text-secondary)] hover:text-white" onclick="navigator.clipboard.writeText(this.parentElement.nextElementSibling.innerText)">Copy</button></div>`;
                    pre.parentNode.insertBefore(wrapper, pre); wrapper.appendChild(pre);
                    hljs.highlightElement(code);
                }
            });
        }

        // Projects Logic
        function getProjects() { const p = JSON.parse(localStorage.getItem(PROJECT_STORAGE_KEY) || '[]'); return [{ id: 'default', name: 'All Chats' }, ...p]; }
        function renderProjects() { dom.projectsListContainer.innerHTML = getProjects().map(p => `<button onclick="window.switchProject('${p.id}')" class="w-full text-left p-2 rounded text-sm hover:bg-[var(--bg-tertiary)] text-[var(--text-secondary)] truncate">${p.name}</button>`).join(''); }
        function saveNewProject() { const n = dom.projectNameInput.value.trim(); if (!n) return; const p = JSON.parse(localStorage.getItem(PROJECT_STORAGE_KEY) || '[]'); p.push({ id: crypto.randomUUID(), name: n }); localStorage.setItem(PROJECT_STORAGE_KEY, JSON.stringify(p)); toggleModal(dom.projectModal, dom.settingsModalOverlay, false); renderProjects(); }
        window.switchProject = (pid) => { currentProjectId = pid; renderChatList(); };

        // Archives Logic
        function openArchiveModal() {
            toggleModal(dom.archiveModal, dom.settingsModalOverlay, true);
            const chats = getAllChats();
            const arch = Object.entries(chats).filter(([_, c]) => c.archived);
            dom.archiveListContainer.innerHTML = arch.length ? arch.map(([id, c]) => `<div class="flex justify-between p-2 border-b border-[var(--border-primary)]"><span class="truncate">${c.title}</span><button onclick="window.unarchive('${id}')" class="text-[var(--accent)] text-xs">Restore</button></div>`).join('') : '<div class="text-center p-4 text-[var(--text-secondary)]">No archives</div>';
        }
        window.unarchive = (id) => { const c = getAllChats(); c[id].archived = false; localStorage.setItem(CHAT_STORAGE_KEY, JSON.stringify(c)); openArchiveModal(); renderChatList(); };

        // Start
        checkAuth();
    </script>
</body>

</html>